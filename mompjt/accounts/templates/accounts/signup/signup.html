{% extends 'base.html' %}
{% load static %}

{% block content %}

<link rel="stylesheet" href="{% static 'css/signup.css' %}">
<script src="{% static 'js/signup.js' %}" defer></script>

<!-- âœ… Daum ì£¼ì†Œ API -->
<script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>

<!-- âœ… signup.jsë¡œ ì „ë‹¬í•  ê°’ (ì „ì—­ ë³€ìˆ˜) -->
<script>
  window.SIGNUP_CONFIG = {
    hasServerErrors: {% if form.errors %}true{% else %}false{% endif %},
    checkIdUrl: "{% url 'accounts:check_id' %}",
    checkNicknameUrl: "{% url 'accounts:check_nickname' %}",
    checkEmailUrl: "{% url 'accounts:check_email' %}",
    sendEmailCodeUrl: "{% url 'accounts:send_email_code' %}",
    verifyEmailCodeUrl: "{% url 'accounts:verify_email_code' %}",
  };
</script>

<div class="login-container" style="max-width: 600px;">
  <h2>íšŒì›ê°€ì…</h2>

  <form method="POST" action="{% url 'accounts:signup' %}" id="signupForm" novalidate>
    {% csrf_token %}

    <!-- âœ… ì•„ì´ë”” (ìë™ ì¤‘ë³µí™•ì¸) -->
    <div class="form-group">
      <label>ì•„ì´ë”” <span class="text-danger">*</span></label>

      <input
        type="text"
        name="username"
        id="username"
        placeholder="ì•„ì´ë”” ì…ë ¥"
        required
        value="{{ form.username.value|default_if_none:'' }}"
        {% if form.username.errors %}data-has-error="1"{% endif %}
      >

      <small id="id_check_msg" class="help-msg"></small>

      <div class="rule-box">
        <div class="rule-title">ì•„ì´ë”” ê·œì¹™</div>
        <div id="id_rule_len" class="rule-item">â€¢ 6~20ì</div>
        <div id="id_rule_char" class="rule-item">â€¢ ì˜ë¬¸/ìˆ«ìë§Œ ì‚¬ìš© ê°€ëŠ¥</div>
        <div id="id_rule_mix" class="rule-item">â€¢ ì˜ë¬¸ê³¼ ìˆ«ìë¥¼ ëª¨ë‘ í¬í•¨í•´ì•¼ í•¨</div>
      </div>

      {% if form.username.errors %}
      <div class="field-error">{{ form.username.errors.0 }}</div>
      {% endif %}
    </div>

    <!-- âœ… ì´ë¦„ -->
    <div class="form-group">
      <label>ì´ë¦„ <span class="text-danger">*</span></label>
      <input
        type="text"
        name="real_name"
        id="real_name"
        placeholder="ì‹¤ëª… ì…ë ¥"
        required
        value="{{ form.real_name.value|default_if_none:'' }}"
        {% if form.real_name.errors %}data-has-error="1"{% endif %}
      >
      {% if form.real_name.errors %}
      <div class="field-error">{{ form.real_name.errors.0 }}</div>
      {% endif %}
    </div>

    <!-- âœ… ë‹‰ë„¤ì„ (ìë™ ì¤‘ë³µí™•ì¸) -->
    <div class="form-group">
      <label>ë‹‰ë„¤ì„ <span class="text-danger">*</span></label>
      <input
        type="text"
        name="nickname"
        id="nickname"
        placeholder="í™œë™ëª… ì…ë ¥"
        required
        value="{{ form.nickname.value|default_if_none:'' }}"
        {% if form.nickname.errors %}data-has-error="1"{% endif %}
      >
      <small id="nickname_check_msg" class="help-msg"></small>

      {% if form.nickname.errors %}
      <div class="field-error">{{ form.nickname.errors.0 }}</div>
      {% endif %}
    </div>

    <!-- âœ… ë¹„ë°€ë²ˆí˜¸ -->
    <div class="form-group">
      <label>ë¹„ë°€ë²ˆí˜¸ <span class="text-danger">*</span></label>

      <div class="input-with-toggle">
        <input
          type="password"
          name="password1"
          id="password1"
          placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥"
          required
          {% if form.password1.errors %}data-has-error="1"{% endif %}
        >
        <button type="button" class="toggle-eye" data-toggle-target="password1" aria-label="ë¹„ë°€ë²ˆí˜¸ ë³´ê¸°">ë³´ê¸°</button>
      </div>

      <div class="rule-box">
        <div class="rule-title">ë¹„ë°€ë²ˆí˜¸ ì¡°ê±´</div>
        <div id="pw_rule_len" class="rule-item">â€¢ ìµœì†Œ 8ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.</div>
        <div id="pw_rule_mix" class="rule-item">â€¢ ì˜ì–´ + ìˆ«ì + íŠ¹ìˆ˜ê¸°í˜¸ë¥¼ ëª¨ë‘ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤.</div>
        <div class="rule-sub">
          (ì•ˆì „í•œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ìœ„í•´ ê¶Œì¥ë˜ëŠ” ê¸°ì¤€ì´ë©°, ìµœì¢… ê²€ì¦ì€ ì„œë²„ì—ì„œ ì²˜ë¦¬ë©ë‹ˆë‹¤.)
        </div>
      </div>

      <small id="pw_strength_msg" class="help-msg"></small>

      {% if form.password1.errors %}
      <div class="field-error">{{ form.password1.errors.0 }}</div>
      {% endif %}
    </div>

    <!-- âœ… ë¹„ë°€ë²ˆí˜¸ í™•ì¸ -->
    <div class="form-group">
      <label>ë¹„ë°€ë²ˆí˜¸ í™•ì¸ <span class="text-danger">*</span></label>

      <div class="input-with-toggle">
        <input
          type="password"
          name="password2"
          id="password2"
          placeholder="ë¹„ë°€ë²ˆí˜¸ ì¬ì…ë ¥"
          required
          {% if form.password2.errors %}data-has-error="1"{% endif %}
        >
        <button type="button" class="toggle-eye" data-toggle-target="password2" aria-label="ë¹„ë°€ë²ˆí˜¸ í™•ì¸ ë³´ê¸°">ë³´ê¸°</button>
      </div>

      <small id="pw_match_msg" class="help-msg"></small>

      {% if form.password2.errors %}
      <div class="field-error">{{ form.password2.errors.0 }}</div>
      {% endif %}

      {% if form.non_field_errors %}
      <div class="field-error">{{ form.non_field_errors.0 }}</div>
      {% endif %}
    </div>

    <!-- âœ… ì£¼ë¯¼ë“±ë¡ë²ˆí˜¸ -->
    <div class="form-group">
      <label>ì£¼ë¯¼ë“±ë¡ë²ˆí˜¸ <span class="text-danger">*</span></label>

      <div class="split-row">
        <input type="text" id="jumin1" placeholder="ì• 6ìë¦¬" inputmode="numeric" maxlength="6" class="split-input">
        <span class="split-dash">-</span>

        <div class="input-with-toggle split-input">
          <input type="password" id="jumin2" placeholder="ë’¤ 7ìë¦¬" inputmode="numeric" maxlength="7">
          <button type="button" class="toggle-eye" data-toggle-target="jumin2" aria-label="ì£¼ë¯¼ë²ˆí˜¸ ë’·ìë¦¬ ë³´ê¸°">ë³´ê¸°</button>
        </div>
      </div>

      <input type="hidden" name="jumin" id="jumin" value="{{ form.jumin.value|default_if_none:'' }}"
        {% if form.jumin.errors %}data-has-error="1"{% endif %}>

      {% if form.jumin.errors %}
      <div class="field-error">{{ form.jumin.errors.0 }}</div>
      {% endif %}
    </div>

    <!-- âœ… ì£¼ì†Œ -->
    <div class="form-group">
      <label>ì£¼ì†Œ <span class="text-danger">*</span></label>

      <div class="inline-row">
        <input type="text" id="address_main" placeholder="ì£¼ì†Œ ê²€ìƒ‰" readonly required style="flex:1;">
        <button type="button" id="btnAddressSearch" class="btn-check btn-check--gray">ğŸ” ê²€ìƒ‰</button>
      </div>

      <input type="text" id="address_detail" placeholder="ìƒì„¸ì£¼ì†Œ ì…ë ¥" required style="margin-top: 8px;">

      <input type="hidden" name="address" id="hidden_real_address" value="{{ form.address.value|default_if_none:'' }}"
        {% if form.address.errors %}data-has-error="1"{% endif %}>

      {% if form.address.errors %}
      <div class="field-error">{{ form.address.errors.0 }}</div>
      {% endif %}
    </div>

    <!-- âœ… íœ´ëŒ€í° -->
    <div class="form-group">
      <label>íœ´ëŒ€í° ë²ˆí˜¸ <span class="text-danger">*</span></label>

      <div class="split-row">
        <input type="text" id="phone1" placeholder="010" inputmode="numeric" maxlength="3" class="split-input">
        <span class="split-dash">-</span>
        <input type="text" id="phone2" placeholder="0000" inputmode="numeric" maxlength="4" class="split-input">
        <span class="split-dash">-</span>
        <input type="text" id="phone3" placeholder="0000" inputmode="numeric" maxlength="4" class="split-input">
      </div>

      <input type="hidden" name="phone" id="phone" value="{{ form.phone.value|default_if_none:'' }}"
        {% if form.phone.errors %}data-has-error="1"{% endif %}>

      {% if form.phone.errors %}
      <div class="field-error">{{ form.phone.errors.0 }}</div>
      {% endif %}
    </div>

    <!-- âœ… ì´ë©”ì¼ -->
    <div class="form-group">
      <label>ì´ë©”ì¼ <span class="text-danger">*</span></label>

      <!-- âœ… ì´ë©”ì¼ + ì¸ì¦ë²ˆí˜¸ ë³´ë‚´ê¸° ë²„íŠ¼(ì˜¤ë¥¸ìª½) -->
      <div class="inline-row">
        <input
          type="email"
          name="email"
          id="email"
          placeholder="example@naver.com"
          required
          value="{{ form.email.value|default_if_none:'' }}"
          {% if form.email.errors %}data-has-error="1"{% endif %}
          style="flex:1;"
        >
        <button type="button" id="btnSendCode" class="btn-check">ì¸ì¦ë²ˆí˜¸ ë³´ë‚´ê¸°</button>
      </div>

      <small id="email_check_msg" class="help-msg"></small>

      {% if form.email.errors %}
      <div class="field-error">{{ form.email.errors.0 }}</div>
      {% endif %}

      <!-- âœ… JSê°€ ì°¾ëŠ” ID: emailCodeWrap (ì¤‘ìš”) -->
    <div id="emailCodeWrap" class="email-code-wrap">
        <div class="inline-row">
            <input type="text" id="emailCode" placeholder="ì¸ì¦ë²ˆí˜¸ 6ìë¦¬" inputmode="numeric" maxlength="6" style="flex:1;">
            <button type="button" id="btnVerifyCode" class="btn-check">ì¸ì¦í•˜ê¸°</button>
        </div>
    </div>

        <!-- âœ… ì„±ê³µ/ì‹¤íŒ¨/ì•ˆë‚´ ë©”ì‹œì§€ëŠ” ë°–ì— ë‘”ë‹¤ (ìˆ¨ê²¨ì§€ì§€ ì•ŠìŒ) -->
        <div id="emailVerifyStatus" class="help-msg" style="margin-top:8px;"></div>


    <!-- âœ… ì„±ë³„ -->
    <div class="form-group">
      <label style="display:block; margin-bottom: 10px;">ì„±ë³„ <span class="text-danger">*</span></label>
      <div class="radio-inline">
        <label class="radio-label">
          <input type="radio" name="gender" value="M" {% if form.gender.value == 'M' %}checked{% endif %}> ë‚¨ì
        </label>
        <label class="radio-label">
          <input type="radio" name="gender" value="F" {% if form.gender.value == 'F' or not form.gender.value %}checked{% endif %}> ì—¬ì
        </label>
      </div>
      {% if form.gender.errors %}
      <div class="field-error">{{ form.gender.errors.0 }}</div>
      {% endif %}
    </div>

    <!-- âœ… ìë…€ ì •ë³´ -->
    <div class="form-group">
      <label style="display:block; margin-bottom: 10px;">ìë…€ ì •ë³´ <span class="text-danger">*</span></label>

      <div class="child-toggle">
        <label class="chip-ui">
          <input type="radio" name="has_children_ui" value="0" checked>
          <span>ìë…€ ì—†ìŒ</span>
        </label>

        <label class="chip-ui">
          <input type="radio" name="has_children_ui" value="1">
          <span>ìë…€ ìˆìŒ</span>
        </label>
      </div>

      <input type="hidden" name="has_children" id="has_children" value="0">

      <div id="childrenStageBox" style="display:none;">
        <div class="stage-grid">
          <label class="chip-ui"><input type="checkbox" name="children_stages" value="kindergarten"><span>ìœ ì¹˜ì›</span></label>
          <label class="chip-ui"><input type="checkbox" name="children_stages" value="elementary"><span>ì´ˆë“±í•™ìƒ</span></label>
          <label class="chip-ui"><input type="checkbox" name="children_stages" value="middle"><span>ì¤‘í•™ìƒ</span></label>
          <label class="chip-ui"><input type="checkbox" name="children_stages" value="high"><span>ê³ ë“±í•™ìƒ</span></label>
          <label class="chip-ui"><input type="checkbox" name="children_stages" value="adult"><span>ì„±ì¸</span></label>
          <label class="chip-ui"><input type="checkbox" name="children_stages" value="other"><span>ê¸°íƒ€</span></label>
        </div>

        <small id="children_stages_msg"></small>
      </div>
    </div>

    <!-- âœ… ì•½ê´€ ë™ì˜ -->
    <div class="form-group" style="margin-top: 30px;">
      <label class="terms-label">
        <input type="checkbox" name="terms_agreed" id="agree_terms">
        <span>[í•„ìˆ˜] ì´ìš©ì•½ê´€ ë° ê°œì¸ì •ë³´ ì²˜ë¦¬ë°©ì¹¨ì— ë™ì˜í•©ë‹ˆë‹¤.</span>
      </label>
    </div>

    <button type="submit" class="btn-login-submit" id="submitBtn" disabled>ê°€ì…í•˜ê¸°</button>
  </form>

  <div class="login-links">
    <a href="{% url 'accounts:login' %}">ì´ë¯¸ ê³„ì •ì´ ìˆìœ¼ì‹ ê°€ìš”? ë¡œê·¸ì¸</a>
  </div>
</div>

{% endblock %}
